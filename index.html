<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>Attribute Race</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
      color: white;
      min-height: 100vh;
      padding: 20px;
      text-align: center;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      padding: 20px;
      background: rgba(0, 0, 0, 0.7);
      border-radius: 20px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }
    
    h1 {
      font-size: 3rem;
      margin: 20px 0;
      text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
      letter-spacing: 2px;
    }
    
    .info-panel {
      display: flex;
      justify-content: space-around;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 15px;
      margin: 20px 0;
      font-size: 1.3rem;
    }
    
    .game-container {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin: 30px 0;
    }
    
    .card {
      aspect-ratio: 1/1;
      background: rgba(255, 255, 255, 0.15);
      border-radius: 15px;
      display: flex;
      flex-direction: column;
      justify-content: space-around;
      align-items: center;
      padding: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
      border: 3px solid transparent;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    .card:hover {
      transform: translateY(-5px);
      background: rgba(255, 255, 255, 0.25);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
    }
    
    .card.selected {
      border-color: #4caf50;
      background: rgba(76, 175, 80, 0.3);
      box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
    }
    
    .card.invalid {
      animation: shake 0.5s;
      border-color: #f44336;
      background: rgba(244, 67, 54, 0.3);
    }
    
    @keyframes shake {
      0%, 100% { transform: translateX(0); }
      20%, 60% { transform: translateX(-5px); }
      40%, 80% { transform: translateX(5px); }
    }
    
    .icons-container {
      display: flex;
      justify-content: center;
      gap: 5px;
      flex-wrap: wrap;
    }
    
    .icon {
      font-size: 1.8rem;
      filter: drop-shadow(0 0 2px rgba(0, 0, 0, 0.5));
    }
    
    .outlined {
      -webkit-text-stroke: 2px currentColor;
      color: transparent !important;
    }
    
    .rules {
      background: rgba(255, 255, 255, 0.1);
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      text-align: left;
      font-size: 1.1rem;
    }
    
    .rules h2 {
      text-align: center;
      margin-bottom: 10px;
      color: #fdbb2d;
    }
    
    .rules ul {
      padding-left: 20px;
    }
    
    .rules li {
      margin: 8px 0;
    }
    
    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    
    button {
      background: linear-gradient(to right, #4CAF50, #8BC34A);
      color: white;
      border: none;
      padding: 15px 30px;
      font-size: 1.2rem;
      border-radius: 50px;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
    }
    
    button:hover {
      transform: scale(1.05);
      box-shadow: 0 7px 20px rgba(0, 0, 0, 0.4);
    }
    
    button:active {
      transform: scale(0.98);
    }
    
    #timer {
      font-weight: bold;
      color: #ffeb3b;
      font-size: 1.4rem;
    }
    
    #score {
      font-weight: bold;
      color: #4caf50;
      font-size: 1.4rem;
    }
    
    .message {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 15px 30px;
      border-radius: 50px;
      font-size: 1.2rem;
      z-index: 100;
      animation: slideIn 0.5s, fadeOut 0.5s 2.5s;
    }
    
    @keyframes slideIn {
      from { top: -50px; opacity: 0; }
      to { top: 20px; opacity: 1; }
    }
    
    @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
    }
    
    @media (max-width: 600px) {
      .game-container {
        grid-template-columns: repeat(3, 1fr);
      }
      
      h1 {
        font-size: 2.2rem;
      }
      
      .info-panel {
        flex-direction: column;
        gap: 10px;
      }
      
      .controls {
        flex-direction: column;
        align-items: center;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Attribute Race üèÅ</h1>
    
    <div class="info-panel">
      <div>–û—á–∫–∏: <span id="score">0</span></div>
      <div>–í—Ä–µ–º—è: <span id="timer">60</span>—Å</div>
    </div>
    
    <div class="game-container" id="game"></div>
    
    <div class="rules">
      <h2>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã</h2>
      <ul>
        <li>–ù–∞–π–¥–∏—Ç–µ –≥—Ä—É–ø–ø—ã –∏–∑ —Ç—Ä—ë—Ö –∫–∞—Ä—Ç–æ—á–µ–∫, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–∞–≤–∏–ª—É: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –≤—Å–µ –∫–∞—Ä—Ç–æ—á–∫–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ª–∏–±–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏, –ª–∏–±–æ —Ä–∞–∑–Ω—ã–º–∏</li>
        <li>–ê—Ç—Ä–∏–±—É—Ç—ã –∫–∞—Ä—Ç–æ—á–µ–∫: —Ñ–æ—Ä–º–∞, —Ü–≤–µ—Ç, –∑–∞–ª–∏–≤–∫–∞ –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ñ–∏–≥—É—Ä</li>
        <li>–ó–∞ –∫–∞–∂–¥—É—é –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –≤—ã –ø–æ–ª—É—á–∞–µ—Ç–µ –æ—á–∫–∏: —á–µ–º –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—Ö–æ–¥–∏—Ç–µ, —Ç–µ–º –±–æ–ª—å—à–µ –æ—á–∫–æ–≤</li>
        <li>–ò–≥—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –≤—Ä–µ–º—è –∏—Å—Ç–µ–∫–∞–µ—Ç</li>
      </ul>
    </div>
    
    <div class="controls">
      <button id="restart">–ù–∞—á–∞—Ç—å –∑–∞–Ω–æ–≤–æ</button>
      <button id="hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞ (3 –æ—á–∫–∞)</button>
    </div>
  </div>

  <script>
    // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–≥—Ä—ã
    const SHAPES = ['circle', 'square', 'triangle'];
    const COLORS = ['red', 'blue', 'green'];
    const FILLS = ['solid', 'outlined'];
    const COUNTS = [1, 2, 3];
    
    // –°–æ—Å—Ç–æ—è–Ω–∏–µ –∏–≥—Ä—ã
    const state = {
      cards: [],
      selected: [],
      score: 0,
      timeLeft: 60,
      timerRunning: true,
      timerId: null
    };
    
    // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
    function generateCards(count) {
      const cards = [];
      const existingCombinations = new Set();
      
      while (cards.length < count) {
        const card = {
          id: Date.now() + Math.random(),
          shape: SHAPES[Math.floor(Math.random() * SHAPES.length)],
          color: COLORS[Math.floor(Math.random() * COLORS.length)],
          fill: FILLS[Math.floor(Math.random() * FILLS.length)],
          count: COUNTS[Math.floor(Math.random() * COUNTS.length)]
        };
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
        const comboKey = `${card.shape}-${card.color}-${card.fill}-${card.count}`;
        
        if (!existingCombinations.has(comboKey)) {
          existingCombinations.add(comboKey);
          cards.push(card);
        }
      }
      
      // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é
      if (cards.length >= 3 && !hasValidCombination(cards)) {
        const [card1, card2] = cards;
        const card3 = createValidCard(card1, card2);
        cards[2] = card3;
      }
      
      return cards;
    }
    
    // –°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∏, –∫–æ—Ç–æ—Ä–∞—è –æ–±—Ä–∞–∑—É–µ—Ç –≤–∞–ª–∏–¥–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é —Å –¥–≤—É–º—è –¥—Ä—É–≥–∏–º–∏
    function createValidCard(card1, card2) {
      const card3 = { ...card1, id: Date.now() + Math.random() };
      
      // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ
      ['shape', 'color', 'fill', 'count'].forEach(attr => {
        const val1 = card1[attr];
        const val2 = card2[attr];
        
        if (val1 === val2) {
          // –û—Å—Ç–∞–≤–ª—è–µ–º —Ç–æ –∂–µ –∑–Ω–∞—á–µ–Ω–∏–µ
        } else {
          // –ù–∞—Ö–æ–¥–∏–º —Ç—Ä–µ—Ç—å–µ —É–Ω–∏–∫–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ
          const options = {
            shape: SHAPES,
            color: COLORS,
            fill: FILLS,
            count: COUNTS
          }[attr];
          
          const thirdOption = options.find(opt => opt !== val1 && opt !== val2);
          if (thirdOption) card3[attr] = thirdOption;
        }
      });
      
      return card3;
    }
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –≤–∞–ª–∏–¥–Ω–æ–π –∫–æ–º–±–∏–Ω–∞—Ü–∏–∏
    function hasValidCombination(cards) {
      for (let i = 0; i < cards.length; i++) {
        for (let j = i + 1; j < cards.length; j++) {
          for (let k = j + 1; k < cards.length; k++) {
            if (isCombinationValid([cards[i], cards[j], cards[k]])) {
              return true;
            }
          }
        }
      }
      return false;
    }
    
    // –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –ü–†–û–í–ï–†–ö–ê –ö–û–ú–ë–ò–ù–ê–¶–ò–ò
    function isCombinationValid(cards) {
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥—ã–π –∞—Ç—Ä–∏–±—É—Ç –æ—Ç–¥–µ–ª—å–Ω–æ
      const attributes = ['shape', 'color', 'fill', 'count'];
      
      return attributes.every(attr => {
        const values = cards.map(card => card[attr]);
        const uniqueValues = new Set(values);
        
        // –ö–æ–º–±–∏–Ω–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞ –µ—Å–ª–∏:
        // 1. –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è –æ–¥–∏–Ω–∞–∫–æ–≤—ã (uniqueValues.size === 1)
        // 2. –í—Å–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ä–∞–∑–Ω—ã–µ (uniqueValues.size === 3)
        return uniqueValues.size === 1 || uniqueValues.size === cards.length;
      });
    }
    
    // –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—ã–±–æ—Ä–∞ –∫–∞—Ä—Ç–æ—á–∫–∏
    function selectCard(index) {
      if (!state.timerRunning) return;
      
      const card = state.cards[index];
      if (!card) return;
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –≤—ã–±—Ä–∞–Ω–∞ –ª–∏ —É–∂–µ —ç—Ç–∞ –∫–∞—Ä—Ç–æ—á–∫–∞
      const isSelected = state.selected.some(c => c.id === card.id);
      
      if (isSelected) {
        // –°–Ω–∏–º–∞–µ–º –≤—ã–¥–µ–ª–µ–Ω–∏–µ
        state.selected = state.selected.filter(c => c.id !== card.id);
      } else if (state.selected.length < 3) {
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –≤ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ
        state.selected.push(card);
        
        // –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–æ–º–±–∏–Ω–∞—Ü–∏—é –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç—Ä–µ—Ç—å–µ–π –∫–∞—Ä—Ç–æ—á–∫–∏
        if (state.selected.length === 3) {
          if (isCombinationValid(state.selected)) {
            // –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
            const timeBonus = Math.max(1, Math.floor(state.timeLeft / 10));
            state.score += timeBonus + 5;
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± —É—Å–ø–µ—Ö–µ
            showMessage(`–û—Ç–ª–∏—á–Ω–æ! +${timeBonus + 5} –æ—á–∫–æ–≤`, 'success');
            
            // –ó–∞–º–µ–Ω—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
            replaceCards();
          } else {
            // –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è
            document.querySelectorAll('.card').forEach((el, i) => {
              if (state.selected.some(c => c.id === state.cards[i]?.id)) {
                el.classList.add('invalid');
                setTimeout(() => el.classList.remove('invalid'), 500);
              }
            });
            
            showMessage('–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è!', 'error');
            setTimeout(() => {
              state.selected = [];
              renderGame();
            }, 500);
          }
        }
      }
      
      renderGame();
    }
    
    // –ó–∞–º–µ–Ω–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫
    function replaceCards() {
      // –£–¥–∞–ª—è–µ–º –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
      state.cards = state.cards.filter(card => 
        !state.selected.some(selected => selected.id === card.id)
      );
      
      // –î–æ–±–∞–≤–ª—è–µ–º –Ω–æ–≤—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
      const newCards = generateCards(3);
      state.cards = [...state.cards, ...newCards];
      
      // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—ã–±–æ—Ä
      state.selected = [];
    }
    
    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è
    function showMessage(text, type) {
      const messageEl = document.createElement('div');
      messageEl.className = `message ${type}`;
      messageEl.textContent = text;
      document.body.appendChild(messageEl);
      
      setTimeout(() => {
        messageEl.remove();
      }, 3000);
    }
    
    // –ü–æ–¥—Å–∫–∞–∑–∫–∞
    function showHint() {
      if (state.score < 3) {
        showMessage('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ—á–∫–æ–≤ –¥–ª—è –ø–æ–¥—Å–∫–∞–∑–∫–∏!', 'error');
        return;
      }
      
      state.score -= 3;
      
      // –ù–∞—Ö–æ–¥–∏–º –ø–µ—Ä–≤—É—é –≤–∞–ª–∏–¥–Ω—É—é –∫–æ–º–±–∏–Ω–∞—Ü–∏—é
      for (let i = 0; i < state.cards.length; i++) {
        for (let j = i + 1; j < state.cards.length; j++) {
          for (let k = j + 1; k < state.cards.length; k++) {
            if (isCombinationValid([state.cards[i], state.cards[j], state.cards[k]])) {
              // –ü–æ–¥—Å–≤–µ—á–∏–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏
              state.selected = [state.cards[i], state.cards[j], state.cards[k]];
              renderGame();
              
              setTimeout(() => {
                state.selected = [];
                renderGame();
              }, 2000);
              
              return;
            }
          }
        }
      }
    }
    
    // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∏–≥—Ä–æ–≤–æ–≥–æ –ø–æ–ª—è
    function renderGame() {
      const gameContainer = document.getElementById('game');
      gameContainer.innerHTML = '';
      
      state.cards.forEach((card, index) => {
        const cardEl = document.createElement('div');
        cardEl.className = 'card';
        
        if (state.selected.some(c => c.id === card.id)) {
          cardEl.classList.add('selected');
        }
        
        cardEl.onclick = () => selectCard(index);
        
        // –°–æ–∑–¥–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –∏–∫–æ–Ω–æ–∫
        const iconsContainer = document.createElement('div');
        iconsContainer.className = 'icons-container';
        
        // –°–æ–∑–¥–∞–µ–º –Ω—É–∂–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∫–æ–Ω–æ–∫
        for (let i = 0; i < card.count; i++) {
          const icon = document.createElement('i');
          
          // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–ª–∞—Å—Å—ã –∏–∫–æ–Ω–∫–∏
          let iconClass = 'icon ';
          iconClass += card.fill === 'solid' ? 'fa-solid ' : 'fa-regular ';
          
          switch (card.shape) {
            case 'circle': iconClass += 'fa-circle'; break;
            case 'square': iconClass += 'fa-square'; break;
            case 'triangle': iconClass += 'fa-triangle'; break;
          }
          
          if (card.fill === 'outlined') {
            iconClass += ' outlined';
          }
          
          icon.className = iconClass;
          icon.style.color = card.color;
          
          iconsContainer.appendChild(icon);
        }
        
        cardEl.appendChild(iconsContainer);
        gameContainer.appendChild(cardEl);
      });
      
      // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
      document.getElementById('score').textContent = state.score;
      document.getElementById('timer').textContent = state.timeLeft;
    }
    
    // –ó–∞–ø—É—Å–∫ —Ç–∞–π–º–µ—Ä–∞
    function startTimer() {
      if (state.timerId) clearInterval(state.timerId);
      
      state.timerId = setInterval(() => {
        if (!state.timerRunning) return;
        
        state.timeLeft--;
        
        if (state.timeLeft <= 0) {
          state.timerRunning = false;
          clearInterval(state.timerId);
          showMessage(`–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –í–∞—à —Å—á—ë—Ç: ${state.score}`, 'info');
        }
        
        renderGame();
      }, 1000);
    }
    
    // –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    function restartGame() {
      state.cards = generateCards(12);
      state.selected = [];
      state.score = 0;
      state.timeLeft = 60;
      state.timerRunning = true;
      
      startTimer();
      renderGame();
    }
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
    document.getElementById('restart').addEventListener('click', restartGame);
    document.getElementById('hint').addEventListener('click', showHint);
    
    // –ó–∞–ø—É—Å–∫ –∏–≥—Ä—ã
    restartGame();
  </script>
</body>
</html>